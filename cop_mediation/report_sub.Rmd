```{r, echo = FALSE}
if(COR == "D29IncludeNotMolecConfirmed"){
  info <- paste0(
    "Day 29 analysis including non-molecularly confirmed endpoints starting ",
    "seven days after first dose."
  )
  title <- "Seven days after first dose"
}else if(COR == "D29IncludeNotMolecConfirmedstart1"){
  info <- paste0(
    "Day 29 analysis including non-molecularly confirmed endpoints starting ",
    "one day after first dose."
  )
  title <- "One day after first dose"
}

```

## `r title`

This section contains results from the `r info`.

```{r, results = "asis"}
here::i_am("cop_mediation/report_sub.Rmd")
bind_result <- readRDS(here::here("cop_mediation", "output",
  paste0("full_result_janssen_pooled_real_", COR, ".rds")
))
adcp_result <- readRDS(here::here("cop_mediation", "output",
  paste0("full_result_janssen_pooled_realADCP_", COR, ".rds")
))
psv_result <- readRDS(here::here("cop_mediation", "output",
  paste0("full_result_janssen_pooled_realPsV_", COR, ".rds")
))
full_result <- rbind(bind_result, psv_result, adcp_result)

init_kable <- knitr::kable(full_result, 
            format = "latex", row.names = FALSE, booktabs = TRUE, escape = FALSE,
            caption = paste0("Table of mediation effect estimates for quantitative markers with 95\\% confidence intervals. \\newline{} Direct VE = VE comparing vaccine vs. placebo with marker set to distribution in placebo. \\newline{} Indirect VE = VE in vaccinated comparing observed marker vs. hypothetical marker under placebo. \\newline{} Prop. mediated = fraction of total risk reduction from vaccine attributed to antibody response."),
            linesep = c(rep("", length(assays)-1), "\\hline"))
if(any(is.na(full_result))){
	init_kable <- kableExtra::add_footnote(init_kable, "NA denotes insufficient overlap in antibody response between vaccinated and control participants.")
}
kableExtra::kable_styling(init_kable, latex_options = c("scale_down", "hold_position"))
```

\clearpage

### Basic statistics on cases

```{r}
summary_stats <- readRDS(
  here::here("cop_mediation", "output", 
    paste0("summary_stats_janssen_pooled_real_", COR, ".rds")
  )
)
summary_stats_ADCP <- readRDS(
  here::here("cop_mediation", "output", 
    paste0("summary_stats_janssen_pooled_realADCP_", COR, ".rds")
  )
)
summary_stats_PsV <- readRDS(
  here::here("cop_mediation", "output", 
    paste0("summary_stats_janssen_pooled_realPsV_", COR, ".rds")
  )
)
is_start1 <- grepl("start1", COR)
```

```{r}
knitr::kable(summary_stats$tab1, caption = paste0("Endpoints included in phase 2 by study arm, binding analysis ", ifelse(is_start1, "starting 1 day after Day 29", "")))
knitr::kable(summary_stats_ADCP$tab1, caption = paste0("Endpoints included in phase 2 by study arm, ADCP analysis", ifelse(is_start1, "starting 1 day after Day 29", "")))
knitr::kable(summary_stats_PsV$tab1, caption = paste0("Endpoints included in phase 2 by study arm, ADCP analysis", ifelse(is_start1, "starting 1 day after Day 29", "")))
```

\clearpage


```{r}
knitr::kable(summary_stats$tab2, caption = paste0("Total endpoints by study arm in binding data set ", ifelse(is_start1, "starting 1 day after Day 29", "")))
knitr::kable(summary_stats_ADCP$tab2, caption = paste0("Total endpoints by study arm in ADCP data set ", ifelse(is_start1, "starting 1 day after Day 29", "")))
knitr::kable(summary_stats_PsV$tab2, caption = paste0("Total endpoints by study arm in PsV data set ", ifelse(is_start1, "starting 1 day after Day 29", "")))
```

\clearpage


```{r}
assay <- c("Binding", "ADCP", "PsV")
day <- c(summary_stats$day_of_analysis,
         summary_stats_ADCP$day_of_analysis,
         summary_stats_PsV$day_of_analysis)
knitr::kable(data.frame(Assay = assay, `Analysis day` = day ),
             caption = "The day used to generate binary endpoints in the mediation analysis")
```
