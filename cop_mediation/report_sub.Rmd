```{r, echo = FALSE}
if(COR == "D29IncludeNotMolecConfirmed"){
  info <- paste0(
    "Day 29 analysis including non-molecularly confirmed endpoints starting ",
    "seven days after first dose."
  )
  title <- "Seven days after first dose"
}else if(COR == "D29IncludeNotMolecConfirmedstart1"){
  info <- paste0(
    "Day 29 analysis including non-molecularly confirmed endpoints starting ",
    "one day after first dose."
  )
  title <- "One day after first dose"
}else if(COR == "D29"){
  info <- "Day 29 analysis"
  title <- "Day 29"
}else if(COR == "D57"){
  info <- "Day 57 analysis"
  title <- "Day 57"
}else if(COR == "D210"){
  info <- "Day 210 analysis"
  title <- "Day 210"
  config$study_name_code <- "HVTN705"
}

```

## `r title`

This section contains results from the `r info`.

```{r, results = "asis"}
here::i_am("cop_mediation/report_sub.Rmd")
if(config$study_name == "ENSEMBLE"){
  full_result <- readRDS(here::here("cop_mediation", "output",
    paste0("full_result_janssen_pooled_real_", COR, ".rds")
  ))
}else if(config$study_name == "COVE"){
  full_result <- readRDS(here::here("cop_mediation", "output",
    paste0("full_result_moderna_real_", COR, ".rds")
  ))
}else if(config$study_name == "AZD1222"){
  full_result <- readRDS(here::here("cop_mediation", "output",
    paste0("full_result_moderna_real_", COR, ".rds")
  ))
}
  if(config$study_name == "HVTN705"){
    full_result_primary <- readRDS(here::here("cop_mediation", "output",
      paste0("full_result_hvtn705secondprimary_", COR, ".rds")
    ))
    full_result <- readRDS(here::here("cop_mediation", "output",
      paste0("full_result_hvtn705second_", COR, ".rds")
    ))
    # full_result <- rbind(full_result_primary, full_result_secondary)
  }

init_kable <- knitr::kable(full_result, 
            format = "latex", row.names = FALSE, booktabs = TRUE, escape = FALSE,
            caption = paste0("Table of mediation effect estimates for quantitative markers with 95\\% confidence intervals. \\newline{} Direct VE = VE comparing vaccine vs. placebo with marker set to distribution in placebo. \\newline{} Indirect VE = VE in vaccinated comparing observed marker vs. hypothetical marker under placebo. \\newline{} Prop. mediated = fraction of total risk reduction from vaccine attributed to antibody response."),
            linesep = '')
if(any(is.na(full_result))){
	init_kable <- kableExtra::add_footnote(init_kable, "NA denotes insufficient overlap in antibody response between vaccinated and control participants.")
}
kableExtra::kable_styling(init_kable, latex_options = c("scale_down", "HOLD_position"))
```

\clearpage

### Basic statistics on cases

```{r}
summary_stats <- readRDS(
  here::here("cop_mediation", "output", 
    paste0("summary_stats_", attr(config,"config"),
           "_", COR, ".rds")
  )
)

base_caption <- "Endpoints included in phase 2 by study arm"
base_caption2 <- "Total endpoints by study arm"
```

```{r}
cor.config <- config::get(config = COR)
kableExtra::kable_styling(
  knitr::kable(summary_stats$tab1, caption = paste0(base_caption, paste0("starting ", cor.config$tpeaklag, " day after Day ", cor.config$tpeak))),
  latex_options = "HOLD_position"
)
```

\clearpage

```{r}
kableExtra::kable_styling(
  knitr::kable(summary_stats$tab2, caption = paste0(base_caption2, paste0("starting ", cor.config$tpeaklag, " day after Day ", cor.config$tpeak))),
  latex_options = "HOLD_position"
)
```


