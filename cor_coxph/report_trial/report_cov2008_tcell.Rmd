# Boxplots at 3 timepoints grouped by case and cohort

First, the COVID endpoint. Second, the any infection endpoint.

```{r boxplots base case and trt, include=F}
for (i in 1:2) {
  tmp = ifelse(i==1,"COVID","Infectn")
  png("../output/cov2008_tcell/boxplots3_"%.%tmp%.%".png", width=9, height=15/4 * 2, units="in", res=300)
  
  dat=subset(dat_proc, ph2.D15.tcell==1)
  
  par(mfrow=c(2,3), mar = c(5,2,4,2))
  for (a in c("CD4_Any_BA.1_IFNg_OR_IL2", "CD8_Any_BA.1_IFNg_OR_IL2")) {
    myboxplots3(dat, marker=a, timepoints=c("B","Day15","Delta15overB"), case_var=ifelse(i==1,"ModtoSevEventIndD15_7toEOS", "AnyInfectionEventIndD15_7toEOS"), case_label = tmp, trt_var="Cohort_short")
  }
  
  dev.off()
}
```

\newpage
```{r, out.width="100%", fig.align="center"}
knitr::include_graphics(normalizePath("../output/cov2008_tcell/boxplots3_COVID.png"))
```

\newpage
```{r, out.width="100%", fig.align="center"}
knitr::include_graphics(normalizePath("../output/cov2008_tcell/boxplots3_Infectn.png"))
```



```{r, echo=FALSE, results='asis'}

trts=c(1)
marker_sets = c("primary", "secondary")

for (COR in c("D15toEOS_cov2008_tcell_symp", "D15toEOS_cov2008_tcell_anyinf")) {
  cat(paste0("# Univariate, ", COR, " \n\n"))
  for (iter in 1:3) {
    config.cor <- config::get(config = COR)
    for(opt in names(config.cor)) eval(parse(text = paste0(names(config.cor[opt])," <- config.cor[[opt]]")))
    
    if (iter==1) {
      fname.suffix.0 <- trt.label <- "D15"
      
    } else if (iter==2) {
      fname.suffix.0 <- trt.label <- "D15Ad26"
      
    } else if (iter==3) {
      fname.suffix.0 <- trt.label <- "D15BNT"
    } 

    cat(paste0("## ", trt.label, " \n\n"))
    pathCoRoutput <- paste0("cor_coxph/output/", attr(config,"config"), "/", COR)
    
    for (marker_set in marker_sets) {
      
      all.markers=get(marker_set)
      fname.suffix = fname.suffix.0%.%"_"%.%marker_set
      assays = all.markers # needed for loading cutpoints
      cat(paste0("### ", marker_set, " \n\n"))
  
      level=3 #  title indent
      show.sample.size <- has.scaled <- show.tertile.curves <- show.forestplots <- T
      has.alt <- show.risk.curves <- show.ve.curves <- plot.geq <- F
      show.q = marker_set=="primary"
      res = knitr::knit_child(c(here::here('cor_coxph', 'report_by_COR.Rmd')), quiet = TRUE); cat(res, sep = '\n')
    }
  }
}


```
