# Summary

tfinal.tpeak is given by the default rule - the last case in ph2 in vaccine arm - applied to D31_7. 

# TLF

```{r params}
t0=151
t1=339
date="2027/10/01"
```

```{r forestplot, echo=FALSE, results='asis'}

labels <- c(
  "M6, Investigational vaccine.", 
  "M6, Comparator vaccine.", 
  "M12, Investigational vaccine.", 
  "M12, Comparator vaccine.")
fig_parts <- c("\\begin{figure}[htbp]\n\\centering\n")

for (i in seq_along(labels)) {
  label <- labels[i]
  pathCoRoutput <- c(
    "cor_coxph/output/nextgen_mock/D31toM6_nextgen_mock",
    "cor_coxph/output/nextgen_mock/D31toM6_nextgen_mock",
    "cor_coxph/output/nextgen_mock/D31toM12_nextgen_mock",
    "cor_coxph/output/nextgen_mock/D31toM12_nextgen_mock"
  )[i]
  fname.suffix <- c(
    "ExpVacc_pseudoneutid50_sera",
    "CtlVacc_pseudoneutid50_sera",
    "ExpVacc_pseudoneutid50_sera",
    "CtlVacc_pseudoneutid50_sera"
  )[i]
  
  file <- paste0(pathCoRoutput, "/hr_forest_", fname.suffix, ".pdf")
  entry <- paste0("\\subfloat[\\textbf{", label, "}]{\n\\includegraphics[width=0.45\\textwidth]{", file, "}}")
  fig_parts <- c(fig_parts, entry)
  
  if (i %% 2 == 1) {
    fig_parts <- c(fig_parts, "\\hfill")
  } else {
    fig_parts <- c(fig_parts, "\\\\")
  }
}

fig_parts <- c(fig_parts, "\\caption{"%.% escape_latex(glue("Correlate of risk analyses of nAb-ID50 titers (KP.2, XBB.1.5, Reference) based on sera from ccIAS participants. Covariate-adjusted hazard ratios (HRs) of COVID-19 (A, B: 7 to {t0} days post D31, C, D: 7 to {t1} days post D31) per 10-fold increase in the designated immune marker at D01, at D31, or for D31/D01 fold-change as indicated. Cases acquired a COVID-19 endpoint (A, B) 7 days post D31 through {t0} days post D31 or (C, D) 7 days post D31 through {t1} days post D31. (A, C) Investigational Vaccine arm; (B, D) Comparator Vaccine arm. Non-cases have no evidence of SARS-CoV-2 infection (i.e., never tested nucleic acid amplification/PCR positive) after D01 up to the date by which the last enrolled participant reached {t1} days post D31 ({date}).  HRs were estimated using inverse probability sampling weighted Cox regression models; 95% confidence intervals (CIs) and Wald-based p-values are shown. Analyses adjust for the randomization strata and baseline risk score via an inverse probability sampling weighted Cox model (cor_coxph module at CoVPN GitHub). FWER, family-wise error rate adjusted p-value. N, Nucleocapsid protein. D50, 50% inhibitory serum dilution neutralizing antibody titer. nAb, neutralizing antibody."))  %.% "}")

fig_parts <- c(fig_parts, "\\end{figure}\n")

txt = paste(fig_parts, collapse = "\n")
message(txt) # for debugging tex
cat(txt, "\n")
```



```{r trichotomized cumulative incidence curves, echo=FALSE, results='asis'}

labels <- c(
  "D01 nAb-ID50 XBB.1.5, Investigational vaccine.", 
  "D01 nAb-ID50 XBB.1.5, Comparator vaccine.", 
  "D31 nAb-ID50 XBB.1.5, Investigational vaccine.", 
  "D31 nAb-ID50 XBB.1.5, Comparator vaccine.")
fig_parts <- c("\\begin{figure}[htbp]\n\\centering\n")

for (i in seq_along(labels)) {
  label <- labels[i]
  pathCoRoutput <- "cor_coxph/output/nextgen_mock/D31toM12_nextgen_mock"
  tp <- c("B", "B", "Day31", "Day31")[i]
  fname.suffix <- c(
    "ExpVacc_pseudoneutid50_sera",
    "CtlVacc_pseudoneutid50_sera",
    "ExpVacc_pseudoneutid50_sera",
    "CtlVacc_pseudoneutid50_sera"
  )[i]
  
  # 
  file <- glue("{pathCoRoutput}/{tp}pseudoneutid50_sera_XBB.1.5_marginalized_risks_cat_{fname.suffix}.pdf")
  entry <- paste0("\\subfloat[\\textbf{", label, "}]{\n\\includegraphics[width=0.45\\textwidth]{", file, "}}")
  fig_parts <- c(fig_parts, entry)
  
  if (i %% 2 == 1) {
    fig_parts <- c(fig_parts, "\\hfill")
  } else {
    fig_parts <- c(fig_parts, "\\\\")
  }
}

fig_parts <- c(fig_parts, "\\caption{"%.% escape_latex(glue("Covariate-adjusted cumulative incidence of COVID-19 by Low, Medium, High tertile of nAb-ID50 XBB.1.5 based on sera from ccIAS participants. (A, B) By D01 marker tertile subgroups for the Investigational and Comparator Vaccine arms; (C, D) By D31 marker tertile subgroups for the Investigational and Comparator Vaccine arms. COVID-19 endpoints are counted between 7 and {t1} days post D31. Antibody marker cut-points defining each tertile (based on the Investigational Vaccine arm) are shown in the upper-left inset panel in each plot. The gray line in each plot is the overall cumulative incidence rate curve in the vaccine arm being compared, where the last point shown is the last event time in the comparison arm. The overall P-value is from a generalized Wald-test p-value of the null hypothesis that the hazard rate is constant across the Low, Medium, and High tertile groups. Analyses adjust for randomization strata and baseline risk score via an inverse probability sampling weighted Cox model (cor_coxph module at CoVPN GitHub). ID50, 50% inhibitory dilution neutralizing antibody titer. nAb, neutralizing antibody titer."))  %.% "}")

fig_parts <- c(fig_parts, "\\end{figure}\n")

txt = paste(fig_parts, collapse = "\n")
message(txt) # for debugging tex
cat(txt, "\n")
```
